/**
 * @package cdgplayer v0.1.17
 * @license GPL-3.0-or-later
 */
function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,d(n.key),n)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t){var e=l();return function(){var i,n=a(t);if(e){var r=a(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function o(t,e,i){return(e=d(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=p(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}},s.apply(null,arguments)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}function l(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(l=function(){return!!t})()}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function f(e,i){return function(t){if(Array.isArray(t))return t}(e)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,o,s,a=[],u=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;u=!1}else for(;!(u=(n=o.call(i)).done)&&(a.push(n.value),a.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(l)throw r}}return a}}(e,i)||function(e,i){if(e){if("string"==typeof e)return t(e,i);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,i):void 0}}(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}function d(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function v(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===i&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}v(".cdg-video-wrapper{background-color:#000;position:relative;text-align:center}.cdg-video-wrapper .cdg-video-player{margin:0 auto;position:relative;width:72%}.cdg-video-wrapper .titleImage{background-color:transparent;height:100%;left:0;position:absolute;top:0;width:100%;z-index:auto}.cdg-video-wrapper .titleImage.hide{display:none}");var m=12,g=300,y=216,k=[6,12,294,204],b=64800,w="0:00",B=["top","bottom"],_=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=i.width,r=void 0===n?g:n,s=i.height,a=void 0===s?y:s,u=i.canvas,l=void 0===u?this.createCanvas(r,a):u,c=i.ctx,h=void 0===c?this.createCanvasContext(l):c,f=i.imageData,p=void 0===f?this.createImageData(l,h,r,a):f;e(this,t),o(this,"hOffset",0),o(this,"vOffset",0),o(this,"keyColor",null),o(this,"backgroundContainer",null),o(this,"borderColor",null),o(this,"memoryColor",null),o(this,"clut",new Array(16).fill([0,0,0])),o(this,"pixels",new Array(b).fill(0)),o(this,"buffer",new Array(b).fill(0)),this.canvas=l,this.ctx=h,this.imageData=p}return n(t,[{key:"createCanvas",value:function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}},{key:"createCanvasContext",value:function(t){var e=t.getContext("2d");return e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e}},{key:"createImageData",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height;return e.createImageData(i,n)}},{key:"reset",value:function(){this.hOffset=0,this.vOffset=0,this.keyColor=null,this.backgroundColor=null,this.borderColor=null,this.memoryColor=null,this.pixels.fill(0)}},{key:"setCLUTEntry",value:function(t,e,i,n){this.clut[t]=[e,i,n].map((function(t){return 17*t}))}},{key:"setPixel",value:function(t,e,i){this.pixels[t+e*g]=i}},{key:"getPixel",value:function(t,e){return this.pixels[t+e*g]}},{key:"getBackground",value:function(){switch(!0){case null!=this.keyColor:return this.keyColor;case null!=this.backgroundColor:return this.backgroundColor;case null!=this.memoryColor:return this.memoryColor;case null!=this.borderColor:return this.borderColor;default:return 0}}},{key:"generateImageData",value:function(){for(var t=0;t<300;t++)for(var e=0;e<216;e++){var i=4*(t+e*g),n=(t-this.hOffset+g)%g+(e-this.vOffset+y)%y*g,r=this.pixels[n],o=f(this.clut[r],3),s=o[0],a=o[1],u=o[2];this.imageData.data[i]=s,this.imageData.data[i+1]=a,this.imageData.data[i+2]=u,this.imageData.data[i+3]=r===this.keyColor?0:255}return this.imageData}},{key:"renderFrame",value:function(){this.ctx.putImageData(this.generateImageData(),0,0)}}]),t}();function P(){var t;console&&console.warn&&(t=console).warn.apply(t,arguments)}var x=function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.bytes=i.slice(n,n+24)}return n(t,[{key:"instruction",get:function(){return this.constructor.instruction}},{key:"opcode",get:function(){return this.constructor.opcode}},{key:"execute",value:function(){}},{key:"bytecodeToString",value:function(){return this.bytes.map((function(t){return t.toString(16).padStart(2,"0")})).join("")}},{key:"detailsToString",value:function(){return""}},{key:"toString",value:function(){return this.instruction}}]),t}();o(x,"instruction",""),o(x,"opcode",null);var C=function(t){u(o,x);var i=r(o);function o(){return e(this,o),i.apply(this,arguments)}return n(o)}();o(C,"instruction","No-op"),o(C,"opcode",0);var S=function(t){u(o,x);var i=r(o);function o(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,o);var s=r+4;return(n=i.call(this,t,r)).color=15&t[s],n.repeat=15&t[s+1],n}return n(o,[{key:"execute",value:function(t){t.memoryColor=this.color,t.backgroundColor=this.color,t.pixels.fill(this.color)}},{key:"detailsToString",value:function(){return"color index: ".concat(this.color)}}]),o}();o(S,"instruction","Memory Preset"),o(S,"opcode",1);var L=function(t){u(o,x);var i=r(o);function o(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e(this,o),(n=i.call(this,t,r)).color=15&t[r+4],n}return n(o,[{key:"execute",value:function(t){t.borderColor=this.color,t.backgroundColor=this.color;for(var e=f(k,4),i=e[0],n=e[1],r=e[2],o=e[3],s=0;s<g;s++){for(var a=0;a<n;a++)t.setPixel(s,a,this.color);for(var u=o+1;u<y;u++)t.setPixel(s,u,this.color)}for(var l=n;l<=o;l++){for(var c=0;c<i;c++)t.setPixel(c,l,this.color);for(var h=r+1;h<g;h++)t.setPixel(h,l,this.color)}}},{key:"detailsToString",value:function(){return"color index: ".concat(this.color)}}]),o}();o(L,"instruction","Border Preset"),o(L,"opcode",2);var I=function(t){u(o,x);var i=r(o);function o(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,o);var s=r+4;return(n=i.call(this,t,r)).colors=[15&t[s],15&t[s+1]],n.row=31&t[s+2],n.column=63&t[s+3],n.pixels=t.slice(s+4,s+16),n}return n(o,[{key:"execute",value:function(t){var e=6*this.column,i=this.row*m;if(e+6>g||i+m>y)P("TileBlock out of bounds (".concat(this.row,", ").concat(this.column,")"));else for(var n=0;n<m;n++)for(var r=this.pixels[n],o=0;o<6;o++){var s=this.colors[r>>5-o&1];this.op(t,e+o,i+n,s)}}},{key:"op",value:function(t,e,i,n){t.setPixel(e,i,n)}},{key:"detailsToString",value:function(){return"row: ".concat(this.row,", column: ").concat(this.column,", color indexes: [").concat(this.colors.join(", "),"]")}}]),o}();o(I,"instruction","Tile Block"),o(I,"opcode",6);var T=function(t){u(o,I);var i=r(o);function o(){return e(this,o),i.apply(this,arguments)}return n(o,[{key:"op",value:function(t,e,i,n){t.setPixel(e,i,t.getPixel(e,i)^n)}}]),o}();o(T,"instruction","Tile Block (XOR)"),o(T,"opcode",38);var E=function(t){u(o,x);var i=r(o);function o(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,o);var s=r+4;(n=i.call(this,t,r)).color=15&t[s];var a=63&t[s+1];n.hCmd=(48&a)>>4,n.hOffset=7&a;var u=63&t[s+2];return n.vCmd=(48&u)>>4,n.vOffset=15&u,n}return n(o,[{key:"execute",value:function(t){t.backgroundColor=this.color,t.hOffset=Math.min(this.hOffset,5),t.vOffset=Math.min(this.vOffset,11);var e=0;switch(this.hCmd){case 2:e=6;break;case 1:e=-6}var i=0;switch(this.hCmd){case 2:i=m;break;case 1:i=-12}if(e||i){for(var n=0;n<g;n++)for(var r=0;r<y;r++)t.buffer[n+r*g]=this.getPixel(t,n+e,r+i);var o=[t.buffer,t.pixels];t.pixels=o[0],t.buffer=o[1]}}},{key:"getPixel",value:function(t,e,i){return e>0&&e<g&&i>0&&i<y?t.pixels[e+i*g]:this.color}},{key:"detailsToString",value:function(){var t=!1,e=!1;return 1===this.vCmd?t="up":2===this.vCmd&&(t="down"),1===this.vCmd?e="left":2===this.vCmd&&(e="right"),[t,e,"vOffset: ".concat(this.vOffset),"hOffset: ".concat(this.hOffset)].filter((function(t){return t})).join(" ")}}]),o}();o(E,"instruction","Scroll Preset"),o(E,"opcode",20);var O=function(t){u(o,E);var i=r(o);function o(){return e(this,o),i.apply(this,arguments)}return n(o,[{key:"getPixel",value:function(t,e,i){return e=(e+g)%g,i=(i+y)%y,t.pixels[e+i*g]}}]),o}();o(O,"instruction","Scroll Copy"),o(O,"opcode",24);var R=function(t){u(o,x);var i=r(o);function o(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e(this,o),(n=i.call(this,t,r)).color=15&t[r+4],n}return n(o,[{key:"execute",value:function(t){t.keyColor=this.color}},{key:"detailsToString",value:function(){return"color index: ".concat(this.color)}}]),o}();o(R,"instruction","Set Key Color"),o(R,"opcode",28);var M=function(t){u(o,x);var i=r(o);function o(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,o);var s=r+4;(n=i.call(this,t,r)).colors=[];for(var a=0;a<8;a++){var u=s+2*a,l=((63&t[u])<<6)+(63&t[u+1]);n.colors[a]=[l>>8,(240&l)>>4,15&l]}return n}return n(o,[{key:"clutOffset",get:function(){return 0}},{key:"execute",value:function(t){for(var e=0;e<8;e++)t.setCLUTEntry(e+this.clutOffset,this.colors[e][0],this.colors[e][1],this.colors[e][2])}},{key:"detailsToString",value:function(){var t=this;return"colors: [".concat(this.colors.map((function(e,i){return"".concat(i+t.clutOffset,": #").concat(e.map((function(t){return t.toString(16)})).join(""))})).join(", "),"]")}}]),o}();o(M,"instruction","Load CLUT (Low)"),o(M,"opcode",30);var A=function(t){u(o,M);var i=r(o);function o(){return e(this,o),i.apply(this,arguments)}return n(o,[{key:"clutOffset",get:function(){return 8}}]),o}();o(A,"instruction","Load CLUT (High)"),o(A,"opcode",31);var j=function(){function t(){e(this,t),o(this,"instructionClassByType",this.constructor.instructionClassByType)}return n(t,[{key:"registerInstruction",value:function(t,e){this.instructionClassByType[t]=e}},{key:"createInstruction",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t in this.instructionClassByType||P("Unknown CDG instruction (instruction = ".concat(t,")"));var n=this.instructionClassByType[t]||C;return new n(e,i)}},{key:"parseInstruction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=63&t[e];if(9===i){var n=63&t[e+1];return this.createInstruction(n,t,e)}return new C(t,e)}},{key:"parseInstructions",value:function(t){for(var e=[],i=t.length,n=0;n<i;n+=24)e.push(this.parseInstruction(t,n));return e.filter((function(t){return t}))}}],[{key:"instructionClassByType",get:function(){var t;return o(t={},0,C),o(t,1,S),o(t,2,L),o(t,6,I),o(t,20,E),o(t,24,O),o(t,28,R),o(t,30,M),o(t,31,A),o(t,38,T),t}}]),t}();function F(){if("undefined"!=typeof performance&&"function"==typeof performance.now)return performance.now();if("undefined"!=typeof process&&"function"==typeof process.hrtime){var t=f(process.hrtime(),2);return 1e3*t[0]+t[1]/1e6}return Date.now()}function q(t){return"function"==typeof requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,25)}var D=function(){function t(){var i=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.contextOptions,s=void 0===r?{}:r,a=n.context,u=void 0===a?this.createContext(s):a,l=n.afterRender;e(this,t),o(this,"instructions",[]),o(this,"pc",-1),o(this,"frameId",null),o(this,"pos",0),o(this,"lastSyncPos",null),o(this,"lastTimestamp",null),o(this,"update",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F();if(-1===i.pc)return i;i.frameId=q(i.update),i.lastSyncPos?i.pos=i.lastSyncPos+(t-i.lastTimestamp):(i.pos+=t-i.lastTimestamp,i.lastTimestamp=t);var e=Math.floor(i.pos/1e3*300),n=e-i.pc;return n>0&&(i.fastForward(n),i.render()),i})),this.context=u,this.afterRender=l}return n(t,[{key:"createContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new _(t)}},{key:"load",value:function(t){var e=new j;return this.instructions=e.parseInstructions(t),this.reset(),this}},{key:"reset",value:function(){return this.pc=0,this.pos=0,this.lastSyncPos=null,this.context.reset(),this}},{key:"render",value:function(){return this.context.renderFrame(),this.afterRender&&this.afterRender(this.context),this}},{key:"executeInstruction",value:function(t){return t&&"function"==typeof t.execute&&t.execute(this.context),this}},{key:"step",value:function(){return this.pc>=0&&this.pc<this.instructions.length?(this.executeInstruction(this.instructions[this.pc]),this.pc+=1):(this.pc=-1,this.stop()),this}},{key:"fastForward",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.pc+t;this.pc>=0&&this.pc<e;)this.step();return this}},{key:"play",value:function(){return this.frameId||(this.frameId=q(this.update),this.lastTimestamp=F()),this}},{key:"stop",value:function(){var t;return t=this.frameId,"function"==typeof cancelAnimationFrame?cancelAnimationFrame(t):clearTimeout(t),this.frameId=null,this.lastSyncPos=null,this}},{key:"sync",value:function(t){return this.lastSyncPos=t,this.lastTimestamp=F(),this}}]),t}(),N=function(){return"undefined"!=typeof Promise&&Promise.defer?Promise.defer():"undefined"!=typeof PromiseUtils&&PromiseUtils.defer?PromiseUtils.defer():(this.resolve=null,this.reject=null,this.promise=new Promise(function(t,e){this.resolve=t,this.reject=e}.bind(this)),void Object.freeze(this))},z=function(t){return JSZip.loadAsync(t).catch((function(t){return Promise.reject(new Error("There was an error reading the zip file.",t))}))},W=function(t){var e=t.filter((function(t){return t.endsWith(".cdg")||t.endsWith(".mp3")}));return 2===e.length?Promise.resolve(e):Promise.reject("The file is not a karaoke .zip file")},U=function(t){var e=t.filter((function(t){return t.name.endsWith(".mp3")})),i=t.filter((function(t){return t.name.endsWith(".cdg")})),n=[];if(e.length&&i.length)return n.push(e[0].async("arraybuffer").catch((function(){return Promise.reject(new Error("Unable to load the audio file"))}))),n.push(function(t){return t.async("uint8array").catch((function(){return Promise.reject(new Error("Unable to load the video file"))}))}(i[0])),n.push(function(t){return t.async("blob").then((function(e){return new Promise((function(i){new jsmediatags.Reader(e).setTagsToRead(["title","artist","album","track","year","genre","picture"]).read({onSuccess:function(t){return i(t)},onError:function(){return i((e=t.name.split(" - "),(n={tags:{}}).tags.album=e[0].trim(),n.tags.artist=e[1]?e[1].trim():n.tags.album,n.tags.title=e[2]?e[2].trim():n.tags.artist,n));var e,n}})}))})).catch((function(){return Promise.reject(new Error("Unable to parse tag data"))}))}(e[0])),Promise.all(n);var r=[];return e.length||r.push("No mp3 audio file present."),i.length||r.push("No cdg video file present."),Promise.reject(new Error(r.join(" ")))},V=function(){function t(){e(this,t)}return n(t,null,[{key:"loadZipFile",value:function(t){return function(t){var e=new N;return JSZipUtils.getBinaryContent(t,(function(i,n){i?e.reject(new Error("There was an error retrieving ".concat(t),i)):e.resolve(n)})),e.promise}(t).then((function(t){return z(t)})).then((function(t){return W(t)})).then((function(t){return U(t)})).catch((function(t){return Promise.reject(t)}))}},{key:"loadFileBuffer",value:function(t){return z(t).then((function(t){return W(t)})).then((function(t){return U(t)})).catch((function(t){return Promise.reject(t)}))}}]),t}(),H=function(){function t(){e(this,t),this._vector=new Float32Array,this._position=0,this._frameCount=0}return n(t,[{key:"vector",get:function(){return this._vector}},{key:"position",get:function(){return this._position}},{key:"startIndex",get:function(){return 2*this._position}},{key:"frameCount",get:function(){return this._frameCount}},{key:"endIndex",get:function(){return 2*(this._position+this._frameCount)}},{key:"clear",value:function(){this.receive(this._frameCount),this.rewind()}},{key:"put",value:function(t){this._frameCount+=t}},{key:"putSamples",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=2*(e=e||0);i>=0||(i=(t.length-n)/2);var r=2*i;this.ensureCapacity(i+this._frameCount);var o=this.endIndex;this.vector.set(t.subarray(n,n+r),o),this._frameCount+=i}},{key:"putBuffer",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e=e||0,i>=0||(i=t.frameCount-e),this.putSamples(t.vector,t.position+e,i)}},{key:"receive",value:function(t){t>=0&&!(t>this._frameCount)||(t=this.frameCount),this._frameCount-=t,this._position+=t}},{key:"receiveSamples",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=2*e,n=this.startIndex;t.set(this._vector.subarray(n,n+i)),this.receive(e)}},{key:"extract",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.startIndex+2*e,r=2*i;t.set(this._vector.subarray(n,n+r))}},{key:"ensureCapacity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=parseInt(2*t);if(this._vector.length<e){var i=new Float32Array(e);i.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=i,this._position=0}else this.rewind()}},{key:"ensureAdditionalCapacity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.ensureCapacity(this._frameCount+t)}},{key:"rewind",value:function(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}}]),t}(),G=function(){function t(i){e(this,t),i?(this._inputBuffer=new H,this._outputBuffer=new H):this._inputBuffer=this._outputBuffer=null}return n(t,[{key:"inputBuffer",get:function(){return this._inputBuffer},set:function(t){this._inputBuffer=t}},{key:"outputBuffer",get:function(){return this._outputBuffer},set:function(t){this._outputBuffer=t}},{key:"clear",value:function(){this._inputBuffer.clear(),this._outputBuffer.clear()}}]),t}(),Z=function(t){u(o,G);var i=r(o);function o(t){var n;return e(this,o),(n=i.call(this,t)).reset(),n._rate=1,n}return n(o,[{key:"rate",set:function(t){this._rate=t}},{key:"reset",value:function(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}},{key:"clone",value:function(){var t=new o;return t.rate=this._rate,t}},{key:"process",value:function(){var t=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(t/this._rate+1);var e=this.transpose(t);this._inputBuffer.receive(),this._outputBuffer.put(e)}},{key:"transpose",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===t)return 0;for(var e=this._inputBuffer.vector,i=this._inputBuffer.startIndex,n=this._outputBuffer.vector,r=this._outputBuffer.endIndex,o=0,s=0;this.slopeCount<1;)n[r+2*s]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*e[i],n[r+2*s+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*e[i+1],s+=1,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!==t)t:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,(o+=1)>=t-1)break t;var a=i+2*o;n[r+2*s]=(1-this.slopeCount)*e[a]+this.slopeCount*e[a+2],n[r+2*s+1]=(1-this.slopeCount)*e[a+1]+this.slopeCount*e[a+3],s+=1,this.slopeCount+=this._rate}return this.prevSampleL=e[i+2*t-2],this.prevSampleR=e[i+2*t-1],s}}]),o}(),K=function(){function t(i){e(this,t),this._pipe=i}return n(t,[{key:"pipe",get:function(){return this._pipe}},{key:"inputBuffer",get:function(){return this._pipe.inputBuffer}},{key:"outputBuffer",get:function(){return this._pipe.outputBuffer}},{key:"fillInputBuffer",value:function(){throw new Error("fillInputBuffer() not overridden")}},{key:"fillOutputBuffer",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.outputBuffer.frameCount<t;){var e=16384-this.inputBuffer.frameCount;if(this.fillInputBuffer(e),this.inputBuffer.frameCount<16384)break;this._pipe.process()}}},{key:"clear",value:function(){this._pipe.clear()}}]),t}(),J=function(){},Q=function(t){u(o,K);var i=r(o);function o(t,n){var r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J;return e(this,o),(r=i.call(this,n)).callback=s,r.sourceSound=t,r.historyBufferSize=22050,r._sourcePosition=0,r.outputBufferPosition=0,r._position=0,r}return n(o,[{key:"position",get:function(){return this._position},set:function(t){if(t>this._position)throw new RangeError("New position may not be greater than current position");var e=this.outputBufferPosition-(this._position-t);if(e<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=e,this._position=t}},{key:"sourcePosition",get:function(){return this._sourcePosition},set:function(t){this.clear(),this._sourcePosition=t}},{key:"onEnd",value:function(){this.callback()}},{key:"fillInputBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=new Float32Array(2*t),i=this.sourceSound.extract(e,t,this._sourcePosition);this._sourcePosition+=i,this.inputBuffer.putSamples(e,0,i)}},{key:"extract",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillOutputBuffer(this.outputBufferPosition+e);var i=Math.min(e,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(t,this.outputBufferPosition,i);var n=this.outputBufferPosition+i;return this.outputBufferPosition=Math.min(this.historyBufferSize,n),this.outputBuffer.receive(Math.max(n-this.historyBufferSize,0)),this._position+=i,i}},{key:"handleSampleData",value:function(t){this.extract(t.data,4096)}},{key:"clear",value:function(){s(a(o.prototype),"clear",this).call(this),this.outputBufferPosition=0}}]),o}(),X=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],$=-10/1.5,Y=function(t){u(o,G);var i=r(o);function o(t){var n;return e(this,o),(n=i.call(this,t))._quickSeek=!0,n.midBufferDirty=!1,n.midBuffer=null,n.overlapLength=0,n.autoSeqSetting=!0,n.autoSeekSetting=!0,n._tempo=1,n.setParameters(44100,0,0,8),n}return n(o,[{key:"clear",value:function(){s(a(o.prototype),"clear",this).call(this),this.clearMidBuffer()}},{key:"clearMidBuffer",value:function(){this.midBufferDirty&&(this.midBufferDirty=!1,this.midBuffer=null)}},{key:"setParameters",value:function(t,e,i,n){t>0&&(this.sampleRate=t),n>0&&(this.overlapMs=n),e>0?(this.sequenceMs=e,this.autoSeqSetting=!1):this.autoSeqSetting=!0,i>0?(this.seekWindowMs=i,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}},{key:"tempo",get:function(){return this._tempo},set:function(t){var e;this._tempo=t,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,e=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(e+this.overlapLength,this.seekWindowLength)+this.seekLength}},{key:"inputChunkSize",get:function(){return this.sampleReq}},{key:"outputChunkSize",get:function(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}},{key:"calculateOverlapLength",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t=(t=this.sampleRate*e/1e3)<16?16:t,t-=t%8,this.overlapLength=t,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}},{key:"checkLimits",value:function(t,e,i){return t<e?e:t>i?i:t}},{key:"calculateSequenceParameters",value:function(){var t,e;this.autoSeqSetting&&(t=150+-50*this._tempo,t=this.checkLimits(t,50,125),this.sequenceMs=Math.floor(t+.5)),this.autoSeekSetting&&(e=28.333333333333332+$*this._tempo,e=this.checkLimits(e,15,25),this.seekWindowMs=Math.floor(e+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}},{key:"quickSeek",set:function(t){this._quickSeek=t}},{key:"clone",value:function(){var t=new o;return t.tempo=this._tempo,t.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),t}},{key:"seekBestOverlapPosition",value:function(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}},{key:"seekBestOverlapPositionStereo",value:function(){var t,e,i,n=0;for(this.preCalculateCorrelationReferenceStereo(),t=0,e=Number.MIN_VALUE;n<this.seekLength;n+=1)(i=this.calculateCrossCorrelationStereo(2*n,this.refMidBuffer))>e&&(e=i,t=n);return t}},{key:"seekBestOverlapPositionStereoQuick",value:function(){var t,e,i,n,r,o=0;for(this.preCalculateCorrelationReferenceStereo(),e=Number.MIN_VALUE,t=0,n=0,r=0;o<4;o+=1){for(var s=0;X[o][s]&&!((r=n+X[o][s])>=this.seekLength);)(i=this.calculateCrossCorrelationStereo(2*r,this.refMidBuffer))>e&&(e=i,t=r),s+=1;n=t}return t}},{key:"preCalculateCorrelationReferenceStereo",value:function(){for(var t,e,i=0;i<this.overlapLength;i+=1)e=i*(this.overlapLength-i),t=2*i,this.refMidBuffer[t]=this.midBuffer[t]*e,this.refMidBuffer[t+1]=this.midBuffer[t+1]*e}},{key:"calculateCrossCorrelationStereo",value:function(t,e){var i=this._inputBuffer.vector;t+=this._inputBuffer.startIndex;for(var n,r=0,o=2,s=2*this.overlapLength;o<s;o+=2)r+=i[n=o+t]*e[o]+i[n+1]*e[o+1];return r}},{key:"overlap",value:function(t){this.overlapStereo(2*t)}},{key:"overlapStereo",value:function(t){var e=this._inputBuffer.vector;t+=this._inputBuffer.startIndex;for(var i,n,r,o,s,a=this._outputBuffer.vector,u=this._outputBuffer.endIndex,l=0,c=1/this.overlapLength;l<this.overlapLength;l+=1)n=(this.overlapLength-l)*c,r=l*c,o=(i=2*l)+t,a[(s=i+u)+0]=e[o+0]*r+this.midBuffer[i+0]*n,a[s+1]=e[o+1]*r+this.midBuffer[i+1]*n}},{key:"process",value:function(){var t,e,i;if(null===this.midBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){t=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(t)),this._outputBuffer.put(this.overlapLength),(e=this.seekWindowLength-2*this.overlapLength)>0&&this._outputBuffer.putBuffer(this._inputBuffer,t+this.overlapLength,e);var n=this._inputBuffer.startIndex+2*(t+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(n,n+2*this.overlapLength)),this.skipFract+=this.nominalSkip,i=Math.floor(this.skipFract),this.skipFract-=i,this._inputBuffer.receive(i)}}}]),o}(),tt=function(t,e){return(t>e?t-e:e-t)>1e-10},et=function(){function t(){e(this,t),this.transposer=new Z(!1),this.stretch=new Y(!1),this._inputBuffer=new H,this._intermediateBuffer=new H,this._outputBuffer=new H,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}return n(t,[{key:"clear",value:function(){this.transposer.clear(),this.stretch.clear()}},{key:"clone",value:function(){var e=new t;return e.rate=this.rate,e.tempo=this.tempo,e}},{key:"rate",get:function(){return this._rate},set:function(t){this.virtualRate=t,this.calculateEffectiveRateAndTempo()}},{key:"rateChange",set:function(t){this._rate=1+.01*t}},{key:"tempo",get:function(){return this._tempo},set:function(t){this.virtualTempo=t,this.calculateEffectiveRateAndTempo()}},{key:"tempoChange",set:function(t){this.tempo=1+.01*t}},{key:"pitch",set:function(t){this.virtualPitch=t,this.calculateEffectiveRateAndTempo()}},{key:"pitchOctaves",set:function(t){this.pitch=Math.exp(.69314718056*t),this.calculateEffectiveRateAndTempo()}},{key:"pitchSemitones",set:function(t){this.pitchOctaves=t/12}},{key:"inputBuffer",get:function(){return this._inputBuffer}},{key:"outputBuffer",get:function(){return this._outputBuffer}},{key:"calculateEffectiveRateAndTempo",value:function(){var t=this._tempo,e=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,tt(this._tempo,t)&&(this.stretch.tempo=this._tempo),tt(this._rate,e)&&(this.transposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}},{key:"process",value:function(){this._rate>1?(this.stretch.process(),this.transposer.process()):(this.transposer.process(),this.stretch.process())}}]),t}(),it=function(){function t(i){e(this,t),this.buffer=i,this._position=0}return n(t,[{key:"dualChannel",get:function(){return this.buffer.numberOfChannels>1}},{key:"position",get:function(){return this._position},set:function(t){this._position=t}},{key:"extract",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.position=i;for(var n=this.buffer.getChannelData(0),r=this.dualChannel?this.buffer.getChannelData(1):this.buffer.getChannelData(0),o=0;o<e;o++)t[2*o]=n[o+i],t[2*o+1]=r[o+i];return Math.min(e,n.length-i)}}]),t}(),nt=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4096,r=t.createScriptProcessor(n,2,2),o=new Float32Array(2*n);return r.onaudioprocess=function(t){var r=t.outputBuffer.getChannelData(0),s=t.outputBuffer.getChannelData(1),a=e.extract(o,n);i(e.sourcePosition),0===a&&e.onEnd();for(var u=0;u<a;u++)r[u]=o[2*u],s[u]=o[2*u+1]},r},rt=function(t){var e,i,n,r=Math.floor(t/60),o=t-60*r;return"".concat(r,":").concat((e=parseInt(o),n=n||"0",(e+="").length>=(i=2)?e:new Array(i-e.length+1).join(n)+e))},ot=function(t){var e=this.timePlayed,i=this.sampleRate;if(this.sourcePosition=t,this.timePlayed=t/i,e!==this.timePlayed){var n=new CustomEvent("play",{detail:{timePlayed:this.timePlayed,formattedTimePlayed:this.formattedTimePlayed,percentagePlayed:this.percentagePlayed}});this._node.dispatchEvent(n)}},st=function(){function t(i,n,r){var o=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J;e(this,t),this._soundtouch=new et;var a=new it(n);this.timePlayed=0,this.sourcePosition=0,this._filter=new Q(a,this._soundtouch,s),this._node=nt(i,this._filter,(function(t){return ot.call(o,t)}),r),this.tempo=1,this.rate=1,this.duration=n.duration,this.sampleRate=i.sampleRate,this.listeners=[]}return n(t,[{key:"formattedDuration",get:function(){return rt(this.duration)}},{key:"formattedTimePlayed",get:function(){return rt(this.timePlayed)}},{key:"percentagePlayed",get:function(){return 100*this._filter.sourcePosition/(this.duration*this.sampleRate)},set:function(t){this._filter.sourcePosition=parseInt(t*this.duration*this.sampleRate),this.sourcePosition=this._filter.sourcePosition,this.timePlayed=this.sourcePosition/this.sampleRate}},{key:"node",get:function(){return this._node}},{key:"pitch",set:function(t){this._soundtouch.pitch=t}},{key:"pitchSemitones",set:function(t){this._soundtouch.pitchSemitones=t}},{key:"rate",set:function(t){this._soundtouch.rate=t}},{key:"tempo",set:function(t){this._soundtouch.tempo=t}},{key:"connect",value:function(t){this._node.connect(t)}},{key:"disconnect",value:function(){this._node.disconnect()}},{key:"on",value:function(t,e){this.listeners.push({name:t,cb:e}),this._node.addEventListener(t,(function(t){return e(t.detail)}))}},{key:"off",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=this.listeners;e&&(i=i.filter((function(t){return t.name===e}))),i.forEach((function(e){t._node.removeEventListener(e.name,(function(t){return e.cb(t.detail)}))}))}}]),t}(),at=function(){function t(){e(this,t),this.fns={any:[]}}return n(t,[{key:"has",value:function(t){return t in this.fns&&this.fns[t].length>0||this.fns.any.length>0}},{key:"on",value:function(t,e){return t in this.fns==!1&&(this.fns[t]=[]),this.fns[t].push(e),e}},{key:"fire",value:function(t,e,i){return this.fns.any.concat(t in this.fns?this.fns[t]:[]).forEach((function(n){return n(e,i,t)})),this}},{key:"off",value:function(t){for(var e in this.fns)for(var i=this.fns[e],n=0;n<i.length;n++)if(i[n]===t)return i.splice(n,1),!0;return!1}},{key:"once",value:function(t,e){var i=this;return this.on(t,(function t(n,r,o){e(n,r,o),i.off(t)})),e}}]),t}(),ut=function(t){if(t.on&&t.off)return t;var e=new at,i=new Proxy(t,{get:function(t,n){if(n in t){if(t.constructor===Array){var r=i;"pop"===n?r=t[t.length-1]:"shift"===n&&(r=t[0]),"push"!==n&&"length"!==n&&e.fire(n,r)}return t[n]}return"on"===n?e.on.bind(e):"once"===n?e.once.bind(e):"off"===n?e.off.bind(e):void 0},set:function(t,i,n){return t.constructor===Array?"length"!==i&&e.fire("change",n):e.has(i)&&e.fire(i,n,t[i]),t[i]=n,!0}});return i},lt=function(t){t.keyColor>=0&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,this.canvas.width,this.canvas.height)},ct=function(t,e){t.clearRect(0,0,e.width,e.height)},ht=function(t){var e=this;return this.shifter&&this.shifter.off(),this.audio.decodeAudioData(t).then((function(t){e.shifter=ut(new st(e.audio,t,1024,(function(){e.stop()}))),e.shifter.on("play",(function(t){e.props.timePlayed=t.formattedTimePlayed,e.props.percentagePlayed=t.percentagePlayed,e.player.sync(1e3*t.timePlayed-800)})),e.shifter.pitch=1,e.props.trackLength=e.shifter.formattedDuration})).catch((function(t){return Promise.reject(new Error("There was an error decoding the audio file",t))}))},ft=function(t){var e=new N;return t?(this.player.load(Array.from(t)),e.resolve()):e.reject(new Error("There was an error loading the video file")),e.promise},pt=function(t,e,i,n,r,o){for(var s=e.split(" "),a="",u=0;u<s.length;u++){var l=a+s[u]+" ";t.measureText(l).width>r&&u>0?(t.fillText(a.trim(),i,n),a=s[u]+" ",n+=o):a=l}t.fillText(a.trim(),i,n)},dt=function(){var t=this.ctx,e=this.canvas,i=e.width-10,n=i/2,r=60;t.font="30px sans-serif",t.fillStyle="#fff",t.textAlign="center",pt(t,this.tag.title,n,r,i,30),t.font="20px sans-serif",r=e.height-60,pt(t,"by ".concat(this.tag.artist),n,r,i,30)},vt=function(t){if(this.tag=t&&t.tags,this.tag)return dt.call(this)},mt=function(t){var e=this,i=[];return i.push(ht.call(this,t[0])),i.push(ft.call(this,t[1])),Promise.all(i).then((function(){e.props.status="File Loaded",e.props.loaded=!0,vt.call(e,t[2])})).catch((function(t){return e.props.status="File Loading Failed",Promise.reject(t)})).then((function(){e.props.loading=!1}))},gt=function(t){this.gainNode.gain.value=t},yt=function(){function t(i){var n,r,s,a=this;if(e(this,t),o(this,"audio",null),o(this,"gainNode",null),o(this,"shifter",null),o(this,"wrapper",null),o(this,"player",null),o(this,"currentSize",1),o(this,"canvas",null),o(this,"ctx",null),o(this,"props",ut({status:"",loaded:!1,loading:!1,isPlaying:!1,timePlayed:w,trackLength:w,percentagePlayed:0,songVolume:1,destroy:!1})),this.wrapper=document.querySelector(i),!this.wrapper)throw new Error('CDGPlayer: and element was not found with the "'.concat(i,'" selector'));this.wrapper.classList.add("cdg-video-wrapper"),this.canvas=(n=g,r=y,(s=document.createElement("canvas")).width=n,s.height=r,s),this.canvas.classList.add("cdg-video-player"),this.ctx=function(t){var e=t.getContext("2d");return e.webkitImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e}(this.canvas),this.player=new D({afterRender:function(t){return lt.call(a,t)}}),this.wrapper.appendChild(this.canvas);var u=document.createElement("div");u.classList.add("titleImage"),this.wrapper.appendChild(u),this.onloaded=this.props.on("loaded",(function(t){t?u.classList.add("hide"):u.classList.remove("hide")})),this.audio=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audio.createGain(),this.onvolume=this.props.on("songVolume",(function(t){gt.call(a,t)})),this.props.songVolume=1}return n(t,[{key:"destroy",value:function(){this.wrapper.classList.remove("cdg-video-wrapper"),this.stop(),this.gainNode.disconnect(),this.shifter&&this.shifter.off(),this.shifter=null,this.gainNode=null,this.audio=null,this.canvas.remove(),this.props.destroy=!0,this.props.off("onvolume")}},{key:"load",value:function(t){var e,i=this;if(this.stop(),ct(this.ctx,this.canvas),this.props.loading=!0,"string"==typeof t){if(!t.toLowerCase().endsWith(".zip"))return this.props.loading=!1,this.props.status="".concat(t,' doesn\'t appear to be a ".zip" file.'),Promise.reject(this.props.status);this.props.status="Retrieving File...",e=V.loadZipFile(t)}else this.props.status="Loading File...",e=V.loadFileBuffer(t);return e.then((function(t){return mt.call(i,t)})).catch((function(t){return Promise.reject(t)}))}},{key:"togglePlay",value:function(){this.props.isPlaying?this.pause():this.start()}},{key:"start",value:function(){var t=this;ct.call(this,this.ctx,this.canvas),this.shifter.connect(this.gainNode),this.gainNode.connect(this.audio.destination),this.audio.resume().then((function(){t.props.isPlaying=!0,t.player.play()}))}},{key:"pause",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.props.isPlaying=t,this.shifter.disconnect(),this.player.stop()}},{key:"stop",value:function(){this.shifter&&(this.pause(),this.changePlayerPosition(0),dt.call(this))}},{key:"changePlayerPosition",value:function(t){t=t<0?0:t>100?100:t,this.shifter.percentagePlayed=t,this.props.percentagePlayed=this.shifter.percentagePlayed,this.props.timePlayed=this.shifter.formattedTimePlayed,this.player.reset(),t||(this.props.isPlaying=!1,this.props.timePlayed=w)}},{key:"changeKey",value:function(t){t=t<-7?-7:t>7?7:t,this.shifter.pitchSemitones=t,this.shifter.tempo=1}},{key:"volume",value:function(t){var e=+(this.gainNode.gain.value+t).toFixed(2);this.props.songVolume=e<0?0:e>1?1:e}},{key:"toggleMute",value:function(){var t=this.gainNode.gain.value;this.props.songVolume=t?0:this.fallbackVolume,this.fallbackVolume=t}}]),t}(),kt='<div class="cdg-controls">\r\n    <span class="playControl">\r\n        <button class="playButton" disabled><i class="icofont-play-alt-1"></i></button>\r\n    </span>\r\n    <span class="timePlayed"></span>\r\n    <div class="progress-container">\r\n        <progress class="progressMeter"\r\n                  ng-disabled="$ctrls.loading"\r\n                  value="0"\r\n                  max="100"></progress>\r\n    </div>\r\n    <span class="trackLength"></span>\r\n    <span>\r\n        <input type="number"\r\n               class="pitch"\r\n               step="1"\r\n               min="-7"\r\n               max="7"\r\n               value="0"\r\n               disabled />\r\n    </span>\r\n    <span class="volumeControl">\r\n        <div>\r\n            <button class="volumeButton" id="song_volume_button" disabled><i class="icofont-audio"></i></button>\r\n            <div class="volumeSlider">\r\n                <input type="range" min="0.00" max="1.00" step="0.01" class="volumeRange" id="song_volume" />\r\n            </div>\r\n        </div>\r\n    </span>\r\n    \x3c!-- <span class="volumeControl">\r\n        <div>\r\n            <button class="volumeButton" id="mic_volume_button"><i class="icofont-mic"></i></button>\r\n            <div class="volumeSlider">\r\n                <input type="range" min="0.0" max="1" step="0.1" class="volumeRange" id="mic_volume" />\r\n            </div>\r\n        </div>\r\n    </span> --\x3e\r\n</div>';v('@font-face{font-family:IcoFont;font-style:normal;font-weight:400;src:inline("./fonts/icofont.woff2") format("woff2"),inline("./fonts/icofont.woff") format("woff")}[class*=" icofont-"],[class^=icofont-]{speak:none;word-wrap:normal;-webkit-font-feature-settings:"liga";-webkit-font-smoothing:antialiased;direction:ltr;font-family:IcoFont!important;font-style:normal;font-variant:normal;font-weight:400;line-height:1;text-transform:none;white-space:nowrap}.icofont-mic:before{content:"\\ef95"}.icofont-mic-mute:before{content:"\\ef94"}.icofont-audio:before{content:"\\eea8"}.icofont-play-alt-1:before{content:"\\eca6"}.icofont-pause:before{content:"\\eca5"}.cdg-controls .playButton>i,.cdg-controls .volumeButton>i,.icofont-md{font-size:2em}.cdg-controls .playButton>i,.cdg-controls .volumeButton>i,.icofont-fw{text-align:center;width:1.25em}.cdg-controls .pitch[disabled],.cdg-controls .playButton[disabled],.cdg-controls .volumeButton[disabled],.mute{color:#a9a9a9}.cdg-controls{-webkit-align-items:center;align-items:center;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;font-size:1.25em;height:40px;justify-content:center;position:relative;width:100%}.cdg-controls>div,.cdg-controls>span{margin:3px 5px}.cdg-controls>div:first-child,.cdg-controls>span:first-child{margin-left:0}.cdg-controls>div:last-child,.cdg-controls>span:last-child{margin-right:0}.cdg-controls .playButton,.cdg-controls .volumeButton{border:none;border-radius:3px;height:34px;outline:none;padding:5px;width:34px}.cdg-controls .playButton[disabled],.cdg-controls .volumeButton[disabled]{cursor:not-allowed}.cdg-controls .volumeControl>div{height:100%;position:relative;width:100%}.cdg-controls .volumeControl>div:hover .volumeSlider{display:block}.cdg-controls .volumeControl>div .volumeSlider{display:none;left:-55px;padding:10px 20px;position:absolute;top:-75px;transform:rotate(270deg);width:100px;z-index:100}.cdg-controls .volumeControl>div .volumeSlider.under{top:75px;transform:rotate(90deg)}.cdg-controls .volumeControl>div .volumeSlider:hover{display:block}.cdg-controls .volumeControl>div .volumeSlider .volumeRange{-webkit-appearance:none;background:#d3d3d3;border:1px solid;border-radius:2.5px;height:5px;opacity:.7;outline:none;-webkit-transition:.2s;transition:opacity .2s;width:100%}.cdg-controls .volumeControl>div .volumeSlider .volumeRange:hover{opacity:1}.cdg-controls .volumeControl>div .volumeSlider .volumeRange::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:#fff;border:1px solid blue;border-radius:50%;cursor:pointer;height:15px;width:15px}.cdg-controls .pitch{font-size:.8em;height:28px;text-align:right}.cdg-controls .pitch[disabled]{cursor:not-allowed}.cdg-controls .progress-container{display:inline-block;flex:0 1 auto;position:relative;width:100%}.cdg-controls .progress-container progress{-webkit-appearance:none;appearance:none;height:1em;width:100%}.cdg-controls .progress-container progress::-webkit-progress-bar{background-color:#eee;border-radius:.5em;box-shadow:inset 0 2px 5px rgba(0,0,0,.25)}.cdg-controls .progress-container progress::-webkit-progress-value{background-image:-webkit-linear-gradient(-45deg,transparent 33%,transparent 0,rgba(0,0,0,.1) 66%,transparent 0),-webkit-linear-gradient(top,hsla(0,0%,100%,.25),rgba(0,0,0,.25)),-webkit-linear-gradient(left,#09c,#f44);background-size:35px 20px,100% 100%,100% 100%;border-radius:.5em}');var bt="icofont-play-alt-1",wt="icofont-pause",Bt=function(t){var e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild},_t=function(){var t=this,e=this.player.props;this.onloaded=e.on("loaded",(function(e){e?(t.playBtn.removeAttribute("disabled"),t.pitch.removeAttribute("disabled"),t.volumeBtn.removeAttribute("disabled")):(t.playBtn.setAttribute("disabled","disabled"),t.pitch.setAttribute("disabled","disabled"),t.volumeBtn.setAttribute("disabled","disabled"))})),this.ontimeplayed=e.on("timePlayed",(function(e,i){e!==i&&(t.timePlayed.innerHTML=e)})),this.onpercentageplayed=e.on("percentagePlayed",(function(e,i){e!==i&&(t.progress.value=e)})),this.ontracklength=e.on("trackLength",(function(e,i){e!==i&&(t.trackLength.innerHTML=e)})),this.ondestroy=e.on("destroy",(function(e){e&&Pt.call(t)})),this.onplay=e.on("isPlaying",(function(e){t.playIcn.classList.remove(bt,wt),t.playIcn.classList.add(e?wt:bt)})),this.onvolume=e.on("songVolume",(function(e){var i=t.volumeIcn;if(t.volumeSlider.value=e,e)return i.classList.contains("mute")?void i.classList.remove("mute"):void 0;i.classList.add("mute")})),this.playBtn.addEventListener("click",(function(){return t.player.togglePlay()})),this.progress.addEventListener("click",(function(e){return xt.call(t,e)})),this.pitch.addEventListener("change",(function(){return Ct.call(t)})),this.volumeSlider.addEventListener("change",(function(){return St.call(t)}))},Pt=function(){var t=this,e=this.player.props;e.off(this.onloaded),e.off(this.ontimeplayed),e.off(this.onpercentageplayed),e.off(this.ontracklength),e.off(this.ondestroy),e.off(this.onplay),e.off(this.onvolume),this.playBtn.removeEventListener("click",(function(){return t.player.togglePlay()})),this.progress.removeEventListener("click",(function(e){return xt.call(t,e)})),this.pitch.removeEventListener("change",(function(){return Ct.call(t)})),this.volumeSlider.removeEventListener("change",(function(){return St.call(t)}))},xt=function(t){var e=t.target.getBoundingClientRect(),i=(t.pageX-e.x)/t.target.offsetWidth;this.player.changePlayerPosition(i)},Ct=function(){var t=this.pitch.value;isNaN(t)?this.pitch.value=this.fallbackPitch:(this.fallbackPitch=t<-7?-7:t>7?7:t,this.player.changeKey(this.fallbackPitch))},St=function(){this.player.props.songVolume=+(parseFloat(this.volumeSlider.value)+0).toFixed(2)},Lt=n((function t(i,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{position:"bottom"};e(this,t),o(this,"controls",Bt(kt)),o(this,"player",null),o(this,"playBtn",null),o(this,"playIcn",null),o(this,"timePlayed",null),o(this,"progress",null),o(this,"trackLength",null),o(this,"pitch",null);var s=document.querySelector(i);s.appendChild(this.controls),this.player=n;var a=this.player.props;if(this.playBtn=this.controls.querySelector(".playButton"),this.playIcn=this.playBtn.querySelector("i"),this.timePlayed=this.controls.querySelector(".timePlayed"),this.timePlayed.innerHTML=a.timePlayed,this.progress=this.controls.querySelector(".progressMeter"),this.progress.value=a.percentagePlayed,this.trackLength=this.controls.querySelector(".trackLength"),this.trackLength.innerHTML=a.trackLength,this.pitch=this.controls.querySelector(".pitch"),this.fallbackPitch=0,!B.includes(r.position))throw new Error("Panel Position must be either 'top' or 'bottom'.");if(this.volumeBtn=this.controls.querySelector("#song_volume_button"),this.volumeIcn=this.volumeBtn.querySelector("i"),this.volumeSlider=this.controls.querySelector("#song_volume"),this.volumeSlider.value=a.songVolume,"top"===r.position){var u=this.controls.querySelector(".volumeSlider");u.classList.add("under")}_t.call(this)}));export{Lt as CDGControls,yt as CDGPlayer};
//# sourceMappingURL=cdgplayer.esm.js.map
